name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches:
      - '*'

permissions:
  contents: read

jobs:
  run_cli:
    runs-on: ubuntu-20.04
    steps:
    - name: Git checkout
      uses: actions/checkout@v3

    - name: Script permissions
      shell: bash
      run: chmod +x ./pushover.sh

    - name: Run script with Args
      shell: bash
      run: ./pushover.sh -D -t ${{ secrets.PUSHOVER_APP }} -u ${{ secrets.PUSHOVER_USER }} -d ${{ secrets.PUSHOVER_DEVICE }} -T Github Action Args -m Github Action Args

  run_config:
    runs-on: ubuntu-20.04
    steps:
    - name: Git checkout
      uses: actions/checkout@v3

    - name: Script permissions
      shell: bash
      run: chmod +x ./pushover.sh
    
    - name: Run script from config
      shell: bash
      run: |
        cp ./pushover-config-test ./pushover-config
        sed -i "s#__PUSHOVER_USER__#${{ secrets.PUSHOVER_USER }}#g" ./pushover-config
        sed -i "s#__PUSHOVER_APP__#${{ secrets.PUSHOVER_APP }}#g" ./pushover-config
        sed -i "s#__PUSHOVER_DEVICE__#${{ secrets.PUSHOVER_DEVICE }}#g" ./pushover-config
        ./pushover.sh -D -T Github Action Config -m Github Action Config
